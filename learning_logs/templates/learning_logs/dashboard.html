{% extends "learning_logs/base.html" %}

{% block page_header %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Analytics Dashboard</h1>
    <a href="{% url 'learning_logs:export_data' %}" class="btn btn--outline">
        <i class="fas fa-download"></i> Export Data
    </a>
</div>
{% endblock page_header %}

{% block content %}
<div class="row" style="margin-bottom: 2rem;">
    <div class="col-md-4">
        <div class="card stat-card">
            <div class="stat-icon">
                <i class="fas fa-book"></i>
            </div>
            <div>
                <h3 class="h5 mb-0">Total Entries</h3>
                <p class="display-4 mb-0">{{ entry_count }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card">
            <div class="stat-icon">
                <i class="fas fa-layer-group"></i>
            </div>
            <div>
                <h3 class="h5 mb-0">Active Topics</h3>
                <p class="display-4 mb-0">{{ topic_count }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card">
            <div class="stat-icon">
                <i class="fas fa-heartbeat"></i>
            </div>
            <div>
                <h3 class="h5 mb-0">Mood Entries</h3>
                <p class="display-4 mb-0">{{ sentiment_trend|length }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card" style="height: 100%;">
            <div class="card-header">
                <h5 class="mb-0">Sentiment Trend (Last 30 Days)</h5>
            </div>
            <div class="card-body">
                <canvas id="sentimentChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card" style="height: 100%;">
            <div class="card-header">
                <h5 class="mb-0">Recent Activity</h5>
            </div>
            <div class="card-body">
                <ul style="list-style: none; padding: 0;">
                    {% for entry in recent_entries %}
                    <li style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-light);">
                        <div style="font-weight: 600;">{{ entry.title }}</div>
                        <div style="font-size: 0.85rem; color: var(--text-dim);">{{ entry.date_created|date:"M d, Y" }}</div>
                    </li>
                    {% empty %}
                    <li class="text-muted">No recent activity.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const sentimentData = {{ sentiment_trend|safe }};
    // Chart initialization logic will be handled here or in a separate JS file
    // For simplicity, embedding basic config:
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('sentimentChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: sentimentData.map(d => d.date),
                datasets: [{
                    label: 'Mood Score',
                    data: sentimentData.map(d => d.score),
                    borderColor: '#4cc9f0',
                    backgroundColor: 'rgba(76, 201, 240, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, max: 10, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    });
</script>
{% endblock content %}